# Haskell LLM Summarizer

A command-line tool that summarizes Haskell files for LLM context by extracting function signatures, type definitions, and associated comments.

## Disclaimer

⚠️ **This is a personal tool with no guarantee of correctness or quality.**

This code was entirely generated by Claude Code from Anthropic. It has not been thoroughly tested, validated, or reviewed by a human. Use at your own risk and do not integrate it into any critical workflow or production environment.

## Overview

The Haskell LLM Summarizer creates condensed representations of Haskell source files by extracting:

- Function signatures
- Type definitions (data, newtype, type, class)
- Associated comments

The outputs are optimized for use in LLM context windows, with minification enabled by default to save tokens.

## Installation

```bash
# Clone the repository
git clone https://github.com/arbus/hs-llm-summarizer.git
cd hs-llm-summarizer

# Build the project
cabal build

# Optional: Install the executable
cabal install
```

## Usage

```bash
# Basic usage (summarize current directory)
hs-llm-summarizer

# Specify a directory
hs-llm-summarizer --dir /path/to/haskell/project

# Summarize a Hackage package (downloads to a temporary directory)
hs-llm-summarizer --package text

# Show only function signatures
hs-llm-summarizer --only-sigs

# Show only type definitions
hs-llm-summarizer --only-types

# Show source locations
hs-llm-summarizer --show-loc

# Disable minification (more readable but uses more tokens)
hs-llm-summarizer --no-minify

# Combine options
hs-llm-summarizer --package vector --only-sigs --no-minify
```

### Output

The default output is minified to save tokens when using with LLMs:

```
Module: FileName.hs | functionName::Type -> Type | data TypeName=Constructor{field::Type} | class TypeClass a where | instance TypeClass Type
```

With `--no-minify`, the output is more readable:

```
-- Module: FileName.hs

 | Function description comment

functionName :: Type -> Type

 | Type description comment

data TypeName = Constructor { field :: Type }

class TypeClass a where

instance TypeClass Type
```

## Options

| Option | Description |
|--------|-------------|
| `-d`, `--dir DIRECTORY` | Directory to analyze (default: current directory) |
| `-p`, `--package PACKAGE` | Download and summarize a Hackage package |
| `-s`, `--only-sigs` | Only show signatures (no implementations) |
| `-t`, `--only-types` | Only show type definitions (data, newtype, type, class) |
| `-l`, `--show-loc` | Show source code locations |
| `-n`, `--no-minify` | Disable minification (minify is on by default) |
| `-h`, `--help` | Show help text |

## Limitations

- **Parser Limitations**: Uses haskell-src-exts 1.23.1, which doesn't support all modern GHC syntax:
  - Post-qualified imports (`import Data.Text qualified as T`)
  - Some newer language extensions 
  - Type applications with DataKinds (like `@'TypeName`)
  - Type operators in imports
  
- **Comment Association**: Comments are associated with declarations based on proximity, which may not always be accurate
  
- **Performance**: Not optimized for very large Haskell projects
  
- **Preprocessor**: A custom preprocessor attempts to handle unsupported syntax, but has limitations with complex cases

## License

MIT License

## Testing

The project includes golden tests to verify parsing and summarization functionality:

```bash
# Run all tests
cabal test

# Update golden files (when making intentional changes)
cabal test --test-option=--accept
```

### Golden Test Structure

- `test/golden/input/`: Contains Haskell source files with various syntax features
- `test/golden/expected/`: Contains expected output for each input file

Adding new tests:
1. Add a new `.hs` file to `test/golden/input/`
2. Run `cabal test --test-option=--accept` to generate the expected output
3. Verify the generated output is correct before committing

## Hackage Package Support

You can summarize packages directly from Hackage without manually downloading them:

```bash
# Summarize a package 
hs-llm-summarizer --package text

# With additional options
hs-llm-summarizer --package vector --only-sigs --no-minify
```

### How the package option works:

1. The tool downloads the package source to a temporary directory using `cabal get`
2. If a `src` directory exists in the package, it focuses on summarizing just those files
3. All relevant Haskell files are processed and summarized

### Limitations:

- Requires `cabal` to be installed and available in your PATH
- Cannot summarize already-installed packages that don't include source files
- Some packages may have complex directory structures that are not ideally handled

### Known Limitations

Some Haskell syntax features are not fully supported by the underlying parser:
- Certain forms of qualified imports (particularly in Advanced.hs, AdvancedNoExt.hs)
- Some newer GHC language extensions
- Complex type operators in imports

## Contributing

This is a personal tool and not actively maintained, but suggestions and improvements are welcome.
